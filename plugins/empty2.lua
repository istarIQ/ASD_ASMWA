{"changed":true,"filter":false,"title":"empty2.lua","tooltip":"/ASD_KARBALA/plugins/empty2.lua","value":"do\n\nlocal BASE_URL = \"http://api.openweathermap.org/data/2.5/weather\"\n\nlocal function get_weather(location)\n  print(\"Finding weather in \", location)\n  location = string.gsub(location,\" \",\"+\")\n  local url = BASE_URL\n  url = url..'?q='..location\n  url = url..'&units=metric'\n  url = url..'&appid=bd82977b86bf27fb59a04b61b657fb6f'\n\n  local b, c, h = http.request(url)\n  if c ~= 200 then return nil end\n\n  local weather = json:decode(b)\n  local city = weather.name\n  local country = weather.sys.country\n  local temp = 'The temperature in '..city\n    ..' (' ..country..')'\n    ..' is '..weather.main.temp..'°C'\n  local conditions = 'Current conditions are: '\n    .. weather.weather[1].description\n\n  if weather.weather[1].main == 'Clear' then\n    conditions = conditions .. ' ☀'\n  elseif weather.weather[1].main == 'Clouds' then\n    conditions = conditions .. ' ☁☁'\n  elseif weather.weather[1].main == 'Rain' then\n    conditions = conditions .. ' ☔'\n  elseif weather.weather[1].main == 'Thunderstorm' then\n    conditions = conditions .. ' ☔☔☔☔'\n  end\n\n  return temp .. '\\n' .. conditions\nend\n\nlocal function run(msg, matches)\n  local city = 'Madrid,ES'\n\n  if matches[1] ~= '!weather' then\n    city = matches[1]\n  end\n  local text = get_weather(city)\n  if not text then\n    text = 'Can\\'t get weather from that city.'\n  end\n  return text\nend\n\nreturn {\n  description = \"weather in that city (Madrid is default)\",\n  usage = \"!weather (city)\",\n  patterns = {\n    \"^!weather$\",\n    \"^!weather (.*)$\"\n  },\n  run = run\n}\n\nend\n","undoManager":{"mark":0,"position":1,"stack":[[{"start":{"row":0,"column":0},"end":{"row":131,"column":0},"action":"remove","lines":[" --[[ ","▀▄ ▄▀▀▄▄▀▀▄▄▀▀▄▄▀▀▄▄▀▀▄▄▀▀▄▄▀▀▄▀▄▄▀▀▄▄▀▀▄▄▀▀▄▄▀▀ ","▀▄ ▄▀                                      ▀▄ ▄▀ ","▀▄       dev ½  🔴 @iq_plus 🔴 ","         ch { @OSCARBOTv2 } ","            ▀▄ ▄▀ ","▀▄ ▄▀                                      ▀▄ ▄▀ ","▀▄▀▀▄▄▀▀▄▄▀▄▄▀▀▄▄▀▀▄▄▀▄▄▀▀▄▄▀▀▄▄▀▄▄▀▀▄▄▀▀▄▄▀▄▄▀▀ ","--]] ",""," do ","","local function pre_process(msg) ","    --Checking mute ","    local hash = 'mate:'..msg.to.id ","    local ali = 'mate:'..msg.to.id ","    local oscar = 'mate:'..msg.to.id ","    local bot = 'mate:'..msg.to.id ","    local oscarteam = 'mate:'..msg.to.id ","    local oscarbot = 'mate:'..msg.to.id ","    if redis:get(hash) and not is_momod(msg) and msg.media  then ","            delete_msg(msg.id, ok_cb, true) ","            end ","    if redis:get(ali) and not is_momod(msg) and msg.media and msg.media.type == 'photo' then ","            delete_msg(msg.id, ok_cb, true) ","            end ","    if redis:get(oscar) and not is_momod(msg) and msg.media and msg.media.type == 'audio' then ","            delete_msg(msg.id, ok_cb, true) ","            end ","    if redis:get(bot) and not is_momod(msg) and msg.media and msg.media.type == 'video' then ","            delete_msg(msg.id, ok_cb, true) ","            end ","","    if redis:get(oscarteam) and not is_momod(msg) and msg.media and msg.media.type == 'unsupported' then ","            delete_msg(msg.id, ok_cb, true) ","            end ","","    if redis:get(oscarbot) and not is_momod(msg) and msg.media and msg.media.type == 'document' then ","            delete_msg(msg.id, ok_cb, true) ","        end ","        return msg  --By @iq_plus and @oscarbotv2 ","    end ","","local function oscar(msg, matches) ","    chat_id =  msg.to.id ","    if matches[1] == 'lock media' then ","                    local hash = 'mate:'..msg.to.id ","                    redis:set(hash, true) ","                    return \"تم كتم الوسائط صور ، صوت ، فيديو ...الخ\" ","","  elseif is_momod(msg) and matches[1] == 'unlock media' then ","      local hash = 'mate:'..msg.to.id ","      redis:del(hash) ","      return \"تم الغاء كتم الوسائط\" ","","  elseif is_momod(msg) and matches[1] == 'lock photo' then ","      local ali = 'mate:'..msg.to.id ","      redis:set(ali, true) ","      return \"تم منع الصور\" ","","  elseif is_momod(msg) and matches[1] == \"unlock photo\" then ","      local ali = 'mate:'..msg.to.id ","      redis:del(ali) ","      return \"تم الغاء كتم الصور\" ","","  elseif is_momod(msg) and matches[1] == \"lock audio\" then ","      local oscar = 'mate:'..msg.to.id ","      redis:set(oscar, true) ","      return \"تم منع الصوتيات\" ","","  elseif is_momod(msg) and matches[1] == \"unlock audio\" then ","      local oscar = 'mate:'..msg.to.id ","      redis:del(oscar) ","      return \"تم الغاء كتم صوتيات\" ","","  elseif is_momod(msg) and matches[1] == \"lock video\" then ","      local bot = 'mate:'..msg.to.id ","      redis:set(bot, true) ","      return \"تم كتم الفيديوهات\" ","","  elseif is_momod(msg) and matches[1] == \"unlock video\" then ","      local bot = 'mate:'..msg.to.id ","      redis:del(bot) ","      return \"تم الغاء كتم الفيديوهات\" ","","  elseif is_momod(msg) and matches[1] == \"lock sticker\" then ","      local oscarteam = 'mate:'..msg.to.id ","      redis:set(oscarteam, true) ","      return \"تم منع الملصقات\" ","","      -- by @iq_plus ","  elseif is_momod(msg) and matches[1] == \"unlock sticker\" then ","      local oscarteam = 'mate:'..msg.to.id ","      redis:del(oscarteam) ","      return \"تم الغاء كتم الملصقات\" ","","","  elseif is_momod(msg) and matches[1] == \"lock file\" then ","      local oscarbot = 'mate:'..msg.to.id ","      redis:set(oscarbot, true) ","      return \"تم كتم الملفات\" ","","","  elseif is_momod(msg) and matches[1] == \"unlock file\" then ","      local oscarbot = 'mate:'..msg.to.id ","      redis:del(oscarbot) ","      return \"تم الغاء الكتم الملفات\" ","","end ","","end ","","return { ","    patterns = { ","        '^[!/#](lock media)$', ","        '^[!/#](unlock media)$', ","        '^[!/#](lock photo)$', ","        '^[!/#](unlock photo)$', ","        '^[!/#](lock audio)$', ","        '^[!/#](unlock audio)$', ","        '^[!/#](lock video)$', ","        '^[!/#](unlock video)$', ","        '^[!/#](lock sticker)$', ","        '^[!/#](unlock sticker)$', ","        '^[!/#](lock file)$', ","        '^[!/#](unlock file)$' ","    }, ","    run = oscar, ","    pre_process = pre_process ","} ","end ",""],"id":2},{"start":{"row":0,"column":0},"end":{"row":30,"column":1},"action":"insert","lines":["— Function reference: http://mathjs.org/docs/reference/functions/categorical.html","","local function mathjs(exp)","  local url = 'http://api.mathjs.org/v1/'","  url = url..'?expr='..URL.escape(exp)","  local b,c = http.request(url)","  local text = nil","  if c == 200 then","    text = 'Result: '..b","  ","  elseif c == 400 then","    text = b","  else","    text = 'Unexpected error\\n'","      ..'Is api.mathjs.org up?'","  end","  return text","end","","local function run(msg, matches)","  return mathjs(matches[1])","end","","return {","  description = \"Calculate math expressions with mathjs API\",","  usage = \"!calc [expression]: evaluates the expression and sends the result.\",","  patterns = {","    \"^!calc (.*)$\"","  },","  run = run","}"]}],[{"start":{"row":0,"column":0},"end":{"row":30,"column":1},"action":"remove","lines":["— Function reference: http://mathjs.org/docs/reference/functions/categorical.html","","local function mathjs(exp)","  local url = 'http://api.mathjs.org/v1/'","  url = url..'?expr='..URL.escape(exp)","  local b,c = http.request(url)","  local text = nil","  if c == 200 then","    text = 'Result: '..b","  ","  elseif c == 400 then","    text = b","  else","    text = 'Unexpected error\\n'","      ..'Is api.mathjs.org up?'","  end","  return text","end","","local function run(msg, matches)","  return mathjs(matches[1])","end","","return {","  description = \"Calculate math expressions with mathjs API\",","  usage = \"!calc [expression]: evaluates the expression and sends the result.\",","  patterns = {","    \"^!calc (.*)$\"","  },","  run = run","}"],"id":3},{"start":{"row":0,"column":0},"end":{"row":61,"column":0},"action":"insert","lines":["do","","local BASE_URL = \"http://api.openweathermap.org/data/2.5/weather\"","","local function get_weather(location)","  print(\"Finding weather in \", location)","  location = string.gsub(location,\" \",\"+\")","  local url = BASE_URL","  url = url..'?q='..location","  url = url..'&units=metric'","  url = url..'&appid=bd82977b86bf27fb59a04b61b657fb6f'","","  local b, c, h = http.request(url)","  if c ~= 200 then return nil end","","  local weather = json:decode(b)","  local city = weather.name","  local country = weather.sys.country","  local temp = 'The temperature in '..city","    ..' (' ..country..')'","    ..' is '..weather.main.temp..'°C'","  local conditions = 'Current conditions are: '","    .. weather.weather[1].description","","  if weather.weather[1].main == 'Clear' then","    conditions = conditions .. ' ☀'","  elseif weather.weather[1].main == 'Clouds' then","    conditions = conditions .. ' ☁☁'","  elseif weather.weather[1].main == 'Rain' then","    conditions = conditions .. ' ☔'","  elseif weather.weather[1].main == 'Thunderstorm' then","    conditions = conditions .. ' ☔☔☔☔'","  end","","  return temp .. '\\n' .. conditions","end","","local function run(msg, matches)","  local city = 'Madrid,ES'","","  if matches[1] ~= '!weather' then","    city = matches[1]","  end","  local text = get_weather(city)","  if not text then","    text = 'Can\\'t get weather from that city.'","  end","  return text","end","","return {","  description = \"weather in that city (Madrid is default)\",","  usage = \"!weather (city)\",","  patterns = {","    \"^!weather$\",","    \"^!weather (.*)$\"","  },","  run = run","}","","end",""]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":61,"column":0},"end":{"row":61,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1462803362152}