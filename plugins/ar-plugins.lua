{"changed":true,"filter":false,"title":"ar-plugins.lua","tooltip":"/ASD_KARBALA/plugins/ar-plugins.lua","value":"--[[ \nâ–€â–„ â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–€          \nâ–€â–„ â–„â–€                                      â–€â–„ â–„â–€ \nâ–€â–„ â–„â–€    BY SAJJAD NOORI                   â–€â–„ â–„â–€ \nâ–€â–„ â–„â–€     BY SAJAD NOORI (@SAJJADNOORI)    â–€â–„ â–„â–€ \nâ–€â–„ â–„â–€ JUST WRITED BY SAJJAD NOORI          â–€â–„ â–„â–€   \nâ–€â–„ â–„â–€        plugins  : ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª      â–€â–„ â–„â–€ \nâ–€â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–„â–„â–€â–€\n--]]\ndo\n\n-- Returns the key (index) in the config.enabled_plugins table\nlocal function plugin_enabled( name )\n  for k,v in pairs(_config.enabled_plugins) do\n    if name == v then\n      return k\n    end\n  end\n  -- If not found\n  return false\nend\n\n-- Returns true if file exists in plugins folder\nlocal function plugin_exists( name )\n  for k,v in pairs(plugins_names()) do\n    if name..'.lua' == v then\n      return true\n    end\n  end\n  return false\nend\n\nlocal function list_all_plugins(only_enabled)\n  local text = ''\n  local nsum = 0\n  for k, v in pairs( plugins_names( )) do\n    --  âœ” enabled, âŒ disabled\n    local status = 'âŒ'\n    nsum = nsum+1\n    nact = 0\n    -- Check if is enabled\n    for k2, v2 in pairs(_config.enabled_plugins) do\n      if v == v2..'.lua' then \n        status = 'âœ”' \n      end\n      nact = nact+1\n    end\n    if not only_enabled or status == 'âœ”' then\n      -- get the name\n      v = string.match (v, \"(.*)%.lua\")\n      text = text..nsum..'. '..v..'  '..status..'\\n'\n    end\n  end\n  local text = text..'\\n Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø«Ø¨ØªÙ‡ ğŸ”¨. '..nsum..'\\nØ§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙØ¹Ù„Ù‡ âœ”ï¸ .'..nact..'\\nØºÙŠØ± Ù…ÙØ¹Ù„ ğŸš« '..nsum-nact..''\n  return text\nend\n\n\nlocal function list_plugins(only_enabled)\n  local text = ''\n  local nsum = 0\n  for k, v in pairs( plugins_names( )) do\n    --  âœ” enabled, âŒ disabled\n    local status = 'âŒ'\n    nsum = nsum+1\n    nact = 0\n    -- Check if is enabled\n    for k2, v2 in pairs(_config.enabled_plugins) do\n      if v == v2..'.lua' then \n        status = 'âœ”' \n      end\n      nact = nact+1\n    end\n    if not only_enabled or status == 'âœ”' then\n      -- get the name\n      v = string.match (v, \"(.*)%.lua\")\n      text = text..v..'  '..status..'\\n'\n    end\n  end\n  local text = text..'\\n'..nact..' plugins enabled from '..nsum..' plugins installed.'\n  return text\nend\n\nlocal function reload_plugins( )\n  plugins = {}\n  load_plugins()\n  return list_plugins(true)\nend\n\n\nlocal function enable_plugin( plugin_name )\n  print('checking if '..plugin_name..' exists')\n  -- Check if plugin is enabled\n  if plugin_enabled(plugin_name) then\n    return 'Ø§ÙÙ„Ù€ÙÙ…ÙÙ„ÙÙ ğŸ“™ '..plugin_name..' Ù…ÙÙ€ÙØ¹Ù€Ù„ÙÙ ğŸ‘ğŸ» âœ”ï¸'\n  end\n  -- Checks if plugin exists\n  if plugin_exists(plugin_name) then\n    -- Add to the config table\n    table.insert(_config.enabled_plugins, plugin_name)\n    print(plugin_name..' added to _config table')\n    save_config()\n    -- Reload the plugins\n    return reload_plugins( )\n  else\n    return ''..plugin_name..' âœ‹ğŸ¿Ù„Ø¢Ù ÙŠÙ€ÙÙˆÙ’Ø¬Ù€Ø¯Ù Ù…Ù€Ù„ÙÙ ğŸ“™ Ø¨Ø£Ø³Ù€Ù… '\n  end\nend\n\nlocal function disable_plugin( name, chat )\n  -- Check if plugins exists\n  if not plugin_exists(name) then\n    return ''..name..' âœ‹ğŸ¿Ù„Ø¢Ù ÙŠÙ€ÙÙˆÙ’Ø¬Ù€Ø¯Ù Ù…Ù€Ù„ÙÙ ğŸ“™ Ø¨Ø£Ø³Ù€Ù… '\n  end\n  local k = plugin_enabled(name)\n  -- Check if plugin is enabled\n  if not k then\n    return 'Ø§ÙÙ„Ù€ÙÙ…ÙÙ„ÙÙ ğŸ“™ '..name..' ØºÙ€ÙŠØ±Ù Ù…ÙÙ€ÙØ¹Ù€Ù„ÙÙ ğŸ‘ğŸ» âŒ'\n  end\n  -- Disable and reload\n  table.remove(_config.enabled_plugins, k)\n  save_config( )\n  return reload_plugins(true)    \nend\n\nlocal function disable_plugin_on_chat(receiver, plugin)\n  if not plugin_exists(plugin) then\n    return \"Plugin doesn't exists\"\n  end\n\n  if not _config.disabled_plugin_on_chat then\n    _config.disabled_plugin_on_chat = {}\n  end\n\n  if not _config.disabled_plugin_on_chat[receiver] then\n    _config.disabled_plugin_on_chat[receiver] = {}\n  end\n\n  _config.disabled_plugin_on_chat[receiver][plugin] = true\n\n  save_config()\n  return 'Plugin '..plugin..' disabled on this chat'\nend\n\nlocal function reenable_plugin_on_chat(receiver, plugin)\n  if not _config.disabled_plugin_on_chat then\n    return 'There aren\\'t any disabled plugins'\n  end\n\n  if not _config.disabled_plugin_on_chat[receiver] then\n    return 'There aren\\'t any disabled plugins for this chat'\n  end\n\n  if not _config.disabled_plugin_on_chat[receiver][plugin] then\n    return 'This plugin is not disabled'\n  end\n\n  _config.disabled_plugin_on_chat[receiver][plugin] = false\n  save_config()\n  return 'Plugin '..plugin..' is enabled again'\nend\n\nlocal function run(msg, matches)\n  -- Show the available plugins \n  if matches[1] == 'Ø§Ù„Ù…Ù„ÙØ§Øª' and is_sudo(msg) then --after changed to moderator mode, set only sudo\n    return list_all_plugins()\n  end\n\n  -- Re-enable a plugin for this chat\n  if matches[1] == 'ØªÙØ¹ÙŠÙ„ Ù…Ù„Ù' and matches[3] == 'chat' then\n    local receiver = get_receiver(msg)\n    local plugin = matches[2]\n    print(\"enable \"..plugin..' on this chat')\n    return reenable_plugin_on_chat(receiver, plugin)\n  end\n\n  -- Enable a plugin\n  if matches[1] == 'ØªÙØ¹ÙŠÙ„ Ù…Ù„Ù' and is_sudo(msg) then --after changed to moderator mode, set only sudo\n    local plugin_name = matches[2]\n    print(\"enable: \"..matches[2])\n    return enable_plugin(plugin_name)\n  end\n\n  -- Disable a plugin on a chat\n  if matches[1] == 'ØªØ¹Ø·ÙŠÙ„ Ù…Ù„Ù' and matches[3] == 'chat' then\n    local plugin = matches[2]\n    local receiver = get_receiver(msg)\n    print(\"disable \"..plugin..' on this chat')\n    return disable_plugin_on_chat(receiver, plugin)\n  end\n\n  -- Disable a plugin\n  if matches[1] == 'ØªØ¹Ø·ÙŠÙ„ Ù…Ù„Ù' and is_sudo(msg) then --after changed to moderator mode, set only sudo\n    if matches[2] == 'plugins' then\n    \treturn 'This plugin can\\'t be disabled'\n    end\n    print(\"disable: \"..matches[2])\n    return disable_plugin(matches[2])\n  end\n\n  -- Reload all the plugins!\n  if matches[1] == 'Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙØ¹Ù„Ù‡' and is_sudo(msg) then --after changed to moderator mode, set only sudo\n    return reload_plugins(true)\n  end\nend\n\nreturn {\n  description = \"Plugin to manage other plugins. Enable, disable or reload.\", \n  usage = {\n      moderator = {\n          \"!plugins disable [plugin] chat : disable plugin only this chat.\",\n          \"!plugins enable [plugin] chat : enable plugin only this chat.\",\n          },\n      sudo = {\n          \"!plugins : list all plugins.\",\n          \"!plugins enable [plugin] : enable plugin.\",\n          \"!plugins disable [plugin] : disable plugin.\",\n          \"!plugins reload : reloads all plugins.\" },\n          },\n  patterns = {\n    \"^Ø§Ù„Ù…Ù„ÙØ§Øª$\",\n    \"^(ØªÙØ¹ÙŠÙ„ Ù…Ù„Ù) ([%w_%.%-]+)$\",\n    \"^(ØªØ¹Ø·ÙŠÙ„ Ù…Ù„Ù) ([%w_%.%-]+)$\",\n    \"^(ØªÙØ¹ÙŠÙ„ Ù…Ù„Ù) ([%w_%.%-]+) (chat)\",\n    \"^(ØªØ¹Ø·ÙŠÙ„ Ù…Ù„Ù) ([%w_%.%-]+) (chat)\",\n    \"^(Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙØ¹Ù„Ù‡)$\" },\n  run = run,\n  moderated = true, -- set to moderator mode\n  --privileged = true\n}\n\nend","undoManager":{"mark":-2,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":231,"column":3},"action":"remove","lines":["--[[ ","â–€â–„ â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–€          ","â–€â–„ â–„â–€                                      â–€â–„ â–„â–€ ","â–€â–„ â–„â–€    BY SAJJAD NOORI                   â–€â–„ â–„â–€ ","â–€â–„ â–„â–€     BY SAJAD NOORI (@SAJJADNOORI)    â–€â–„ â–„â–€ ","â–€â–„ â–„â–€ JUST WRITED BY SAJJAD NOORI          â–€â–„ â–„â–€   ","â–€â–„ â–„â–€        plugins  : ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª      â–€â–„ â–„â–€ ","â–€â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–„â–„â–€â–€â–„â–„â–€â–€â–„â–„â–€â–„â–„â–€â–€","--]]","do","","-- Returns the key (index) in the config.enabled_plugins table","local function plugin_enabled( name )","  for k,v in pairs(_config.enabled_plugins) do","    if name == v then","      return k","    end","  end","  -- If not found","  return false","end","","-- Returns true if file exists in plugins folder","local function plugin_exists( name )","  for k,v in pairs(plugins_names()) do","    if name..'.lua' == v then","      return true","    end","  end","  return false","end","","local function list_all_plugins(only_enabled)","  local text = ''","  local nsum = 0","  for k, v in pairs( plugins_names( )) do","    --  âœ” enabled, âŒ disabled","    local status = 'âŒ'","    nsum = nsum+1","    nact = 0","    -- Check if is enabled","    for k2, v2 in pairs(_config.enabled_plugins) do","      if v == v2..'.lua' then ","        status = 'âœ”' ","      end","      nact = nact+1","    end","    if not only_enabled or status == 'âœ”' then","      -- get the name","      v = string.match (v, \"(.*)%.lua\")","      text = text..nsum..'. '..v..'  '..status..'\\n'","    end","  end","  local text = text..'\\n Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø«Ø¨ØªÙ‡ ğŸ”¨. '..nsum..'\\nØ§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙØ¹Ù„Ù‡ âœ”ï¸ .'..nact..'\\nØºÙŠØ± Ù…ÙØ¹Ù„ ğŸš« '..nsum-nact..''","  return text","end","","","local function list_plugins(only_enabled)","  local text = ''","  local nsum = 0","  for k, v in pairs( plugins_names( )) do","    --  âœ” enabled, âŒ disabled","    local status = 'âŒ'","    nsum = nsum+1","    nact = 0","    -- Check if is enabled","    for k2, v2 in pairs(_config.enabled_plugins) do","      if v == v2..'.lua' then ","        status = 'âœ”' ","      end","      nact = nact+1","    end","    if not only_enabled or status == 'âœ”' then","      -- get the name","      v = string.match (v, \"(.*)%.lua\")","      text = text..v..'  '..status..'\\n'","    end","  end","  local text = text..'\\n'..nact..' plugins enabled from '..nsum..' plugins installed.'","  return text","end","","local function reload_plugins( )","  plugins = {}","  load_plugins()","  return list_plugins(true)","end","","","local function enable_plugin( plugin_name )","  print('checking if '..plugin_name..' exists')","  -- Check if plugin is enabled","  if plugin_enabled(plugin_name) then","    return 'Ø§ÙÙ„Ù€ÙÙ…ÙÙ„ÙÙ ğŸ“™ '..plugin_name..' Ù…ÙÙ€ÙØ¹Ù€Ù„ÙÙ ğŸ‘ğŸ» âœ”ï¸'","  end","  -- Checks if plugin exists","  if plugin_exists(plugin_name) then","    -- Add to the config table","    table.insert(_config.enabled_plugins, plugin_name)","    print(plugin_name..' added to _config table')","    save_config()","    -- Reload the plugins","    return reload_plugins( )","  else","    return ''..plugin_name..' âœ‹ğŸ¿Ù„Ø¢Ù ÙŠÙ€ÙÙˆÙ’Ø¬Ù€Ø¯Ù Ù…Ù€Ù„ÙÙ ğŸ“™ Ø¨Ø£Ø³Ù€Ù… '","  end","end","","local function disable_plugin( name, chat )","  -- Check if plugins exists","  if not plugin_exists(name) then","    return ''..name..' âœ‹ğŸ¿Ù„Ø¢Ù ÙŠÙ€ÙÙˆÙ’Ø¬Ù€Ø¯Ù Ù…Ù€Ù„ÙÙ ğŸ“™ Ø¨Ø£Ø³Ù€Ù… '","  end","  local k = plugin_enabled(name)","  -- Check if plugin is enabled","  if not k then","    return 'Ø§ÙÙ„Ù€ÙÙ…ÙÙ„ÙÙ ğŸ“™ '..name..' ØºÙ€ÙŠØ±Ù Ù…ÙÙ€ÙØ¹Ù€Ù„ÙÙ ğŸ‘ğŸ» âŒ'","  end","  -- Disable and reload","  table.remove(_config.enabled_plugins, k)","  save_config( )","  return reload_plugins(true)    ","end","","local function disable_plugin_on_chat(receiver, plugin)","  if not plugin_exists(plugin) then","    return \"Plugin doesn't exists\"","  end","","  if not _config.disabled_plugin_on_chat then","    _config.disabled_plugin_on_chat = {}","  end","","  if not _config.disabled_plugin_on_chat[receiver] then","    _config.disabled_plugin_on_chat[receiver] = {}","  end","","  _config.disabled_plugin_on_chat[receiver][plugin] = true","","  save_config()","  return 'Plugin '..plugin..' disabled on this chat'","end","","local function reenable_plugin_on_chat(receiver, plugin)","  if not _config.disabled_plugin_on_chat then","    return 'There aren\\'t any disabled plugins'","  end","","  if not _config.disabled_plugin_on_chat[receiver] then","    return 'There aren\\'t any disabled plugins for this chat'","  end","","  if not _config.disabled_plugin_on_chat[receiver][plugin] then","    return 'This plugin is not disabled'","  end","","  _config.disabled_plugin_on_chat[receiver][plugin] = false","  save_config()","  return 'Plugin '..plugin..' is enabled again'","end","","local function run(msg, matches)","  -- Show the available plugins ","  if matches[1] == 'Ø§Ù„Ù…Ù„ÙØ§Øª' and is_sudo(msg) then --after changed to moderator mode, set only sudo","    return list_all_plugins()","  end","","  -- Re-enable a plugin for this chat","  if matches[1] == 'ØªÙØ¹ÙŠÙ„ Ù…Ù„Ù' and matches[3] == 'chat' then","    local receiver = get_receiver(msg)","    local plugin = matches[2]","    print(\"enable \"..plugin..' on this chat')","    return reenable_plugin_on_chat(receiver, plugin)","  end","","  -- Enable a plugin","  if matches[1] == 'ØªÙØ¹ÙŠÙ„ Ù…Ù„Ù' and is_sudo(msg) then --after changed to moderator mode, set only sudo","    local plugin_name = matches[2]","    print(\"enable: \"..matches[2])","    return enable_plugin(plugin_name)","  end","","  -- Disable a plugin on a chat","  if matches[1] == 'ØªØ¹Ø·ÙŠÙ„ Ù…Ù„Ù' and matches[3] == 'chat' then","    local plugin = matches[2]","    local receiver = get_receiver(msg)","    print(\"disable \"..plugin..' on this chat')","    return disable_plugin_on_chat(receiver, plugin)","  end","","  -- Disable a plugin","  if matches[1] == 'ØªØ¹Ø·ÙŠÙ„ Ù…Ù„Ù' and is_sudo(msg) then --after changed to moderator mode, set only sudo","    if matches[2] == 'plugins' then","    \treturn 'This plugin can\\'t be disabled'","    end","    print(\"disable: \"..matches[2])","    return disable_plugin(matches[2])","  end","","  -- Reload all the plugins!","  if matches[1] == 'Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙØ¹Ù„Ù‡' and is_sudo(msg) then --after changed to moderator mode, set only sudo","    return reload_plugins(true)","  end","end","","return {","  description = \"Plugin to manage other plugins. Enable, disable or reload.\", ","  usage = {","      moderator = {","          \"!plugins disable [plugin] chat : disable plugin only this chat.\",","          \"!plugins enable [plugin] chat : enable plugin only this chat.\",","          },","      sudo = {","          \"!plugins : list all plugins.\",","          \"!plugins enable [plugin] : enable plugin.\",","          \"!plugins disable [plugin] : disable plugin.\",","          \"!plugins reload : reloads all plugins.\" },","          },","  patterns = {","    \"^Ø§Ù„Ù…Ù„ÙØ§Øª$\",","    \"^(ØªÙØ¹ÙŠÙ„ Ù…Ù„Ù) ([%w_%.%-]+)$\",","    \"^(ØªØ¹Ø·ÙŠÙ„ Ù…Ù„Ù) ([%w_%.%-]+)$\",","    \"^(ØªÙØ¹ÙŠÙ„ Ù…Ù„Ù) ([%w_%.%-]+) (chat)\",","    \"^(ØªØ¹Ø·ÙŠÙ„ Ù…Ù„Ù) ([%w_%.%-]+) (chat)\",","    \"^(Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙØ¹Ù„Ù‡)$\" },","  run = run,","  moderated = true, -- set to moderator mode","  --privileged = true","}","","end"],"id":2}]]},"ace":{"folds":[],"scrolltop":2860,"scrollleft":0,"selection":{"start":{"row":222,"column":33},"end":{"row":222,"column":33},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":203,"state":"start","mode":"ace/mode/lua"}},"timestamp":1462379199000}